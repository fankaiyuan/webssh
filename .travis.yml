sudo: required
addons:
  apt:
    update: true
    packages:
    - docker-ce
services:
- docker
script:
- export DOCKER_CLI_EXPERIMENTAL=enabled
- source sha_function.sh
- flag_alpine=$(is_base "treehouses/alpine:latest" "kaiyfan/webssh:latest")
- echo $flag_alpine
- echo $DOCKERAPIKEY | docker login -u "kaiyfan" --password-stdin
- docker run --rm --privileged multiarch/qemu-user-static --reset -p yes
- "./docker-build.sh treehouses/alpine:latest arm"
- flag=$(compare "treehouses/alpine:latest" "kaiyfan/webssh:latest")
- echo $flag
before_deploy:
- tag_time=$(date +%Y%m%d%H%M)
- echo $tag_time
- tag_latest="latest"
- tag_time=$timetag
- echo $tag_time
- create_manifest kaiyfan/webssh $tag1 $tag2 kaiyfan/webssh-tags:arm
- docker manifest inspect kaiyfan/webssh:$tag_latest
- docker manifest inspect kaiyfan/webssh:$tag_time
deploy:
- provider: script
  script: docker manifest push kaiyfan/webssh:$tag_latest; docker manifest push kaiyfan/webssh:$tag_time
  skip_cleanup: true
  on:
    all_branches: true
    condition: "$flag = true"
env:
  global:
  - secure: "mJHL4qYTGvM70jGhYS5RM3CYMJNlEwITPq84XIWCYdGJA3PlfyosHkqwRNo2pKTiEUaIQF7A5VnaUtEu9IUQ8aVx+Xeyfm61ptvHFQ2OJOUNn2r1DBM9tfmI3EjE0Jm8E7FZIoYkCBytxjrT0kyT+4fVr4yZpkmg+AH6e0ctIeR0VxljSDyq7y2npYbtS36bnFx/JCNjL7jyn7ppaq1/ydUSbIfktT8YnVFVw6tryQvCBYr214r5YtfRBlHiJBVz0R1PH0J8NZNqIvyR0b5R7VoT3cnQwXgQKsmMoNNSsolxci+8eprHjy00md7tiplLPidx4/+gdyF4B0omVYEwFP1zlA+aDr2XDgakEpb8VEgYfezcJJaN07NqPQOoKg97d9gkozdf24wYpBg+EpSOfnm1Hq7IqkaJa7llMwtEjDP9XyI/v0HybZ4ooB1UAvr3GkQflAO4VqNdcZ6jh7Pj7AsOvOefn82PolHbaiihkXqCWS8t3Tio37sMZAD/Pjp1SaGhCwpyA/hfkNSc+YcnH6yq5q061s/xPxcUvbnjSmik3gC2HWEWoj5UuspXyB8WdsYtKpglRHympxGoyGmbde5aYl70mLVCs8xJCFxHna7yVshWrtmZoicYonJGIJtFJhxiK/N0g4g+qiChzHvJICIQZf0x77tlbuFvwCzIfMI="

