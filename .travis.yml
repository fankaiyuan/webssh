sudo: required
addons:
  apt:
    update: true
    packages:
    - docker-ce
services:
- docker
script:
- export DOCKER_CLI_EXPERIMENTAL=enabled
- source sha_function.sh
- flag_alpine=$(is_base "treehouses/alpine:latest" "kaiyfan/webssh:latest")
- echo $flag_alpine
- echo $DOCKERAPIKEY | docker login -u "kaiyfan" --password-stdin
- docker run --rm --privileged multiarch/qemu-user-static --reset -p yes
- "./docker-build.sh treehouses/alpine:latest arm"
- flag=$(compare "treehouses/alpine:latest" "kaiyfan/webssh:latest")
- echo $flag
before_deploy:
- tag_time=$(date +%Y%m%d%H%M)
- echo $tag_time
- tag_latest="latest"
- tag_time=$timetag
- echo $tag_time
- create_manifest kaiyfan/webssh $tag1 $tag2 kaiyfan/webssh-tags:arm
- docker manifest inspect kaiyfan/webssh:$tag_latest
- docker manifest inspect kaiyfan/webssh:$tag_time
deploy:
- provider: script
  script: docker manifest push kaiyfan/webssh:$tag_latest; docker manifest push kaiyfan/webssh:$tag_time
  skip_cleanup: true
  on:
    all_branches: true
    condition: "$flag = true"
env:
  global:
    secure: "n4L8xDnm0BcdXpNPKnOVgbEtjioTggPgDV1nfYHm1WkV2VUFur5GRCV4T6KJqbzBr58ZzMlXpcuDxT1hxoj2GmgFNr/sbbar3qRh/B8vmmztGtJWoawV25DGAqZCidEnm/cPSaX3qXYrms4YWMC6uIyUFWvnz/6BZO6w4Sc4AVc/V3gdGsHsMeg7OxQHpsxhlvwXoHMmhbERJ0nOkj7974JiBc8UREpnpgonPHkfIQ3fM8wEQx79ZikiE23aaQqdoesCJ/Bi6BLi0r8Ju+5TYwzGYn1Y3Ne1cLPZOnXM77X+0e7vKnEFI4jZWGImrpNcKVfBJHDubRHMy8NlvaS/u4p0/6FAkdXyqsM4sJRrjNI2SOz0ub7oXLR3TUd/77zPPTs3JI47Zm+QPGkbUukKMk92QWVR+19tTF02EmIydLX5OmC8lqdfqf19EWLwWG5AfqgQttZe7PxIgTJdpBmXJ/QIFJgELnozoystPLbSYl2SW19U2bbV+c24UBFfo/wZVLg6gWBbrZ8QfcQWEfcqFIq8Y1GZ0VdySYWWufInffajVul9O4FtjmKyQGIurUs5XLw0MDRWjWiHxGte2It5IOnI/u1zPSP//rTI3xS14ZfReYJIOIr06O/eaIAorIGMPrCG59FVecUNGqKs+hkMl+RGFlO4N+zZHxV4j1hpO3g="
